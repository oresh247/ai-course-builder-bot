# üéØ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: Multi-tier fallback strategy

## –ü—Ä–æ–±–ª–µ–º–∞

OpenAI —É–ø–æ—Ä–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É JSON (—Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Ä–æ–∫–∞ –≤–º–µ—Å—Ç–æ –ª–µ–∫—Ü–∏–π).

## –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ø—ã—Ç–æ–∫

‚ùå **v1-v2**: –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ - –ù–ï –ø–æ–º–æ–≥–ª–æ
‚ùå **v3**: Prefix prompting - –ù–ï –ø–æ–º–æ–≥–ª–æ
‚ùå **v4**: JSON Schema —Å gpt-4o-2024-08-06 - –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ –∏–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏

## ‚úÖ –§–ò–ù–ê–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï: Multi-tier fallback

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ **–∫–∞—Å–∫–∞–¥–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è** —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ fallback:

### –£—Ä–æ–≤–µ–Ω—å 1: JSON Mode (gpt-4-turbo-preview)

–°–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `response_format: {"type": "json_object"}`:

```python
try:
    response = openai_client.chat.completions.create(
        model="gpt-4-turbo-preview",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT + "\n\n–í–´–í–û–î –¢–û–õ–¨–ö–û –í JSON –§–û–†–ú–ê–¢–ï!"},
            {"role": "user", "content": prompt}
        ],
        response_format={"type": "json_object"},  # JSON mode
        temperature=0.3
    )
    logger.info("‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º JSON mode (gpt-4-turbo-preview)")
except Exception as e:
    # Fallback –Ω–∞ —É—Ä–æ–≤–µ–Ω—å 2
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö —Å—Ö–µ–º
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ–º –º–æ–¥–µ–ª–µ–π

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- ‚ö†Ô∏è –ù–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (—Ç–æ–ª—å–∫–æ —á—Ç–æ —ç—Ç–æ JSON)

### –£—Ä–æ–≤–µ–Ω—å 2: –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º (gpt-4)

–ï—Å–ª–∏ JSON mode –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—ã—á–Ω—ã–π gpt-4:

```python
except Exception as json_mode_error:
    logger.warning(f"JSON mode –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {json_mode_error}")
    
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": prompt}
        ],
        temperature=0.3
    )
```

### –£—Ä–æ–≤–µ–Ω—å 3: –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç

–ï—Å–ª–∏ –≤—Å–µ API-–∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å:

```python
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {e}")
    logger.warning("üìå –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏")
    return self._get_test_module_content(module)
```

## –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å fallback strategy —É—Å–∏–ª–µ–Ω –ø—Ä–æ–º–ø—Ç:

### 1. System Prompt

```
–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è IT-–∫—É—Ä—Å–æ–≤.
–°–æ–∑–¥–∞—ë—à—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –õ–ï–ö–¶–ò–ò —Å–æ –°–õ–ê–ô–î–ê–ú–ò –≤ —Ñ–æ—Ä–º–∞—Ç–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π.

–í–ê–ñ–ù–û: –¢—ã –í–°–ï–ì–î–ê –≤–æ–∑–≤—Ä–∞—â–∞–µ—à—å JSON —Å –ø–æ–ª–µ–º "lectures" (–º–∞—Å—Å–∏–≤ –ª–µ–∫—Ü–∏–π).
–ö–∞–∂–¥–∞—è –ª–µ–∫—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ "slides" (–º–∞—Å—Å–∏–≤ —Å–ª–∞–π–¥–æ–≤).
–ù–ò–ö–û–ì–î–ê –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Ä–æ–∫–∞ —Å –ø–æ–ª—è–º–∏ lesson_title, lesson_goal, content_outline.
–û—Ç–≤–µ—á–∞–µ—à—å —Å—Ç—Ä–æ–≥–æ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º JSON —Ñ–æ—Ä–º–∞—Ç–µ –±–µ–∑ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π.

–í–´–í–û–î –¢–û–õ–¨–ö–û –í JSON –§–û–†–ú–ê–¢–ï!
```

### 2. User Prompt

- –£–±—Ä–∞–ª–∏ —Å–ª–æ–≤–æ "–£–†–û–ö–ò" ‚Üí "–¢–ï–ú–´ –î–õ–Ø –õ–ï–ö–¶–ò–ô"
- –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã ‚ùå –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ / ‚úÖ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- –Ø–≤–Ω–æ —É–∫–∞–∑–∞–Ω—ã —Ç—Ä–µ–±—É–µ–º—ã–µ –ø–æ–ª—è JSON

### 3. –ù–∏–∑–∫–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞

`temperature=0.3` –≤–º–µ—Å—Ç–æ 0.7 –¥–ª—è –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–≥–æ —Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫

–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```python
except Exception as e:
    logger.error(f"–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {e}")
    logger.error(f"–¢–∏–ø –æ—à–∏–±–∫–∏: {type(e).__name__}")
    logger.error(f"–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏: {str(e)}")
    
    if "model" in str(e).lower() or "schema" in str(e).lower():
        logger.warning("‚ö†Ô∏è –ú–æ–¥–µ–ª—å –∏–ª–∏ Schema –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã!")
```

## –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ

### –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π —Ä–∞–±–æ—Ç–µ JSON mode:

```
INFO:content_generator:–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –º–æ–¥—É–ª—è: ...
INFO:content_generator:‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º JSON mode (gpt-4-turbo-preview)
INFO:content_generator:–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç OpenAI (XXXX —Å–∏–º–≤–æ–ª–æ–≤)
INFO:content_generator:–ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: X –ª–µ–∫—Ü–∏–π, YY —Å–ª–∞–π–¥–æ–≤
```

### –ü—Ä–∏ fallback –Ω–∞ gpt-4:

```
WARNING:content_generator:JSON mode –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ...
INFO:content_generator:üîÑ –ü—Ä–æ–±—É–µ–º –æ–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º –±–µ–∑ schema...
INFO:content_generator:–ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç –æ—Ç OpenAI (XXXX —Å–∏–º–≤–æ–ª–æ–≤)
```

### –ü—Ä–∏ fallback –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:

```
ERROR:content_generator:–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ...
WARNING:content_generator:üìå –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
INFO:content_generator:‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç: 3 –ª–µ–∫—Ü–∏–∏, 24 —Å–ª–∞–π–¥–∞
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—à–µ–Ω–∏—è

‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - –±–æ—Ç –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –¥–∞–∂–µ –µ—Å–ª–∏ OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
‚úÖ **–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –∏ —Ä–µ–∂–∏–º–æ–≤
‚úÖ **UX** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø—É—Å—Ç—å –∏ —Ç–µ—Å—Ç–æ–≤—ã–π)

## –ü–æ—á–µ–º—É OpenAI –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç—ã?

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ lessons** - –ø–æ–ª–µ `lessons_list` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —É—Ä–æ–∫–∞, –∏ –º–æ–¥–µ–ª—å –∫–æ–ø–∏—Ä—É–µ—Ç –µ—ë
2. **–û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏** - GPT-4 –≤–∏–¥–µ–ª –±–æ–ª—å—à–µ –ø—Ä–∏–º–µ—Ä–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã "—É—Ä–æ–∫–∞" –≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Å—Ç—Ä–æ–≥–æ—Å—Ç—å** - –±–µ–∑ JSON Schema –º–æ–¥–µ–ª—å "–¥—É–º–∞–µ—Ç –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ"
4. **–ü–µ—Ä–µ–≤–æ–¥** - —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –º–æ–∂–µ—Ç –ø—É—Ç–∞—Ç—å –º–æ–¥–µ–ª—å ("–ª–µ–∫—Ü–∏—è" vs "—É—Ä–æ–∫")

**JSON mode** —á–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è —Ö–æ—Ç—è –±—ã –≤–∞–ª–∏–¥–Ω—ã–π JSON.

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

- `content_generator.py` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ multi-tier fallback strategy

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ï—Å–ª–∏ JSON mode —Ç–æ–∂–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ—Ç–æ–º
2. **–ì–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –ª–µ–∫—Ü–∏–∏ –ø–æ –æ–¥–Ω–æ–π** - –¥–µ–ª–∞–π—Ç–µ N –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –±–æ–ª—å—à–æ–≥–æ
3. **–°–º–µ–Ω–∏—Ç–µ —è–∑—ã–∫ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π** - –≤–æ–∑–º–æ–∂–Ω–æ, –º–æ–¥–µ–ª—å –ª—É—á—à–µ –ø–æ–Ω–∏–º–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–π

---

**–î–∞—Ç–∞:** 19 –æ–∫—Ç—è–±—Ä—è 2025

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É (—Å fallback –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç)

